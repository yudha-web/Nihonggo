<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Minna Nihonggo</title>
  <style>
    :root{
      --bg:#0f1720; --card:#0f1728; --muted:#9aa6b2; --accent:#1db954; --panel:#0b1220;
      --glass: rgba(255,255,255,0.03);
      --main-text: #e6eef3;
      /* Neumorphism Shadows */
      --shadow-light: rgba(255, 255, 255, 0.05);
      --shadow-dark: rgba(0, 0, 0, 0.6);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:linear-gradient(180deg,#071021 0%, #0b1220 100%); color:var(--main-text);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      padding:28px;
    }
    .wrap{max-width:500px; margin:0 auto; display:grid; grid-template-columns:1fr; gap:22px}
    
    /* KARTU PLAYER UTAMA */
    .main-player-card {
        background: var(--card);
        border-radius: 18px;
        /* Neumorphism Shadow (Inner Shadow) */
        box-shadow: inset 8px 8px 16px var(--shadow-dark), inset -8px -8px 16px var(--shadow-light); 
        overflow: hidden;
        padding-bottom: 20px;
    }

    /* HEADER GRADIENT */
    .visual-header {
      background: linear-gradient(180deg, #1db954 0%, rgba(15, 23, 40, 0) 100%);
      padding: 30px 22px 70px 22px;
      position: relative;
      color: white;
      text-align: center;
    }
    .visual-header h1 {font-size: 26px; font-weight: 700; margin: 0; letter-spacing: -0.5px;}
    .visual-header .meta {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.9);
        margin-top: 4px;
        text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }

    /* Kontrol Player */
    .player-controls-area {
        position: relative;
        margin-top: -50px;
        z-index: 10;
        padding: 0 22px;
    }

    /* KELOMPOK KONTROL UTAMA */
    .main-controls-group {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 5px;
      margin-bottom: 25px;
    }
    .main-controls-center-group { 
        display: flex;
        align-items: center;
        gap: 16px;
    }
    .main-controls-center-group .smbtn { 
        margin: 0 -4px;
    }


    /* Tombol Play/Pause yang besar */
    .bigbtn{
      width:64px; height:64px; border-radius:999px; border:none;
      background:var(--accent); 
      color:white;
      /* Box Shadow yang lebih menonjol */
      box-shadow: 0 8px 25px rgba(29, 185, 84, 0.4); 
      display:inline-flex; align-items:center; justify-content:center;
      cursor:pointer; flex-shrink: 0;
      transition: all 0.2s ease-out;
    }
    .bigbtn:hover {transform: scale(1.05);}
    .bigbtn svg {width: 28px; height: 28px;}

    /* Tombol Navigasi Kecil */
    .smbtn{
      width:44px; height:44px; border-radius:999px; border:none;
      background:var(--card); /* Background sesuai kartu */
      color:var(--muted);
      cursor:pointer; display: flex; align-items: center; justify-content: center; 
      flex-shrink: 0; 
      transition: all 0.2s;
      /* Neumorphism Shadow (Outer Shadow) */
      box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light); 
    }
    .smbtn:hover {
        background:var(--glass); 
        color: var(--main-text); 
        box-shadow: 2px 2px 5px var(--shadow-dark), -2px -2px 5px var(--shadow-light); 
    }
    .smbtn:active {
        box-shadow: inset 2px 2px 5px var(--shadow-dark), inset -2px -2px 5px var(--shadow-light); 
        transform: scale(0.98);
    }
    .smbtn svg {width: 22px; height: 22px;}
    .smbtn.active-control { 
        color: var(--accent); 
    }
    
    /* TRACK INFO */
    .track-info{ 
      text-align: center;
      margin-bottom: 20px; 
    } 
    .title{font-weight:600; font-size: 18px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 6px;}
    .sub{color:var(--muted);font-size:13px} /* Subtitle biasa */
    
    /* AUDIO VISUALIZER (Pengganti Subtitle) */
    .audio-visualizer {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 15px; /* Ketinggian visualizer */
        gap: 2px;
        margin-top: 5px;
    }
    .bar-item {
        width: 3px;
        border-radius: 999px;
        background-color: var(--muted);
        transition: height 0.1s;
    }
    .bar-item.active {
        background-color: var(--accent);
        animation: pulsing 1.2s ease-in-out infinite;
    }
    /* Animasi sederhana untuk membuat visualizer terlihat hidup */
    @keyframes pulsing {
        0% { height: 5px; }
        50% { height: 12px; }
        100% { height: 5px; }
    }
    .bar-item:nth-child(2n) { animation-delay: 0.1s; }
    .bar-item:nth-child(3n) { animation-delay: 0.2s; }
    .bar-item:nth-child(4n) { animation-delay: 0.3s; }
    
    
    .progress{height:8px;background:rgba(255,255,255,0.08);border-radius:999px;cursor:pointer;position:relative; margin-bottom: 8px;}
    .progress > .bar{height:100%;width:0;background:var(--accent);border-radius:999px}
    .time{display:flex;justify-content:space-between;font-size:12px;color:var(--muted); margin-bottom: 20px;}
    
    .controlsBottom{
        display:flex; gap:15px; align-items:center; justify-content: space-between; 
        padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.05); margin-top: 10px; margin-bottom: 20px; 
    }

    .volume-control input[type="range"]::-webkit-slider-thumb {
        /* Neumorphism Shadow untuk thumb slider */
        box-shadow: 0 0 0 3px var(--card), 0 0 0 5px var(--shadow-light); 
    }
    .volume-control input[type="range"]:focus::-webkit-slider-thumb {
        box-shadow: 0 0 0 3px var(--accent); 
    }


    /* PLAYLIST CARD */
    .playlist-card{
      background:var(--card);
      padding:18px;
      border-radius:12px;
      /* Neumorphism Shadow (Outer Shadow) */
      box-shadow: 8px 8px 16px var(--shadow-dark), -8px -8px 16px var(--shadow-light); 
    }
    
    .playlist-header button{
      /* Tombol Play All dibuat seperti tombol kecil lainnya */
      background:var(--card);
      box-shadow: 4px 4px 8px var(--shadow-dark), -4px -4px 8px var(--shadow-light); 
    }

    .track{display:flex;align-items:center;gap:12px;padding:8px 10px;border-radius:8px;cursor:pointer}
    .track:hover{background:rgba(255,255,255,0.02)}
    .track.active{background:rgba(29,185,84,0.1); color: #fff; font-weight: 500;} /* Active state lebih tegas */
    .track .num{width:20px;text-align:left;color:var(--muted);font-size:13px; font-weight: 500;}
    .track .name{flex:1;font-size:14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}

    /* Ikon Equalizer di Playlist (ILLUSTRATOR) */
    .track .equalizer-icon {
        width: 16px; 
        height: 16px;
        display: none; /* Default tersembunyi */
        align-items: flex-end;
        justify-content: center;
        gap: 1px;
    }
    .track.active .equalizer-icon {
        display: flex; /* Hanya tampil saat aktif */
    }
    .eq-bar {
        width: 3px;
        height: 5px;
        background: var(--accent);
        border-radius: 999px;
        animation: eq-animate 0.8s infinite ease-in-out alternate;
    }
    .eq-bar:nth-child(2) { animation-delay: -0.6s; }
    .eq-bar:nth-child(3) { animation-delay: -0.3s; }

    @keyframes eq-animate {
        0% { height: 5px; }
        100% { height: 12px; }
    }


    /* FOOTER/COPYRIGHT */
    .main-player-card .copyright {
        text-align: center;
        padding-top: 15px; 
        border-top: 1px solid rgba(255,255,255,0.03); 
        color: var(--muted);
        font-size: 11px; 
    }
    /* (CSS untuk Instagram link sama seperti sebelumnya) */
  </style>
</head>
<body>
  <div class="wrap">

    <section class="main-player-card">
      <div class="visual-header">
          <h1>Minna Nihonggo Audio</h1>
          <div class="meta">87 Track | Pelajaran Tata Bahasa dan Percakapan</div>
      </div>
      
      <div class="player-controls-area">
        <div class="main-controls-group">
          <button id="shuffle" class="smbtn" title="Shuffle">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16"><path d="M12.43 1.25H3.57C1.57 1.25 0 2.82 0 4.82v6.36c0 2 1.57 3.57 3.57 3.57h8.86c2 0 3.57-1.57 3.57-3.57V4.82c0-2-1.57-3.57-3.57-3.57zm-6.14 7.64a.5.5 0 0 1 0-.707l2.828-2.828a.5.5 0 0 1 .707 0l2.828 2.828a.5.5 0 0 1 0 .707l-2.828 2.828a.5.5 0 0 1-.707 0l-2.828-2.828zM3.5 6.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z"/></svg>
          </button>
          
          <div class="main-controls-center-group">
            <button id="prev" class="smbtn" title="Previous">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16"><path d="M.5 3.5A.5.5 0 0 1 1 4v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5zm4-1a.5.5 0 0 1 .5.5v3.146L14.707 9.854a.5.5 0 0 1 .146.353v3.146a.5.5 0 0 1-.724.447l-7-4.5a.5.5 0 0 1-.01-.734l7-4.5A.5.5 0 0 1 14 3.25z"/></svg>
            </button>
            <button id="rwd" class="smbtn" title="Rewind 10s">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16"><path d="M12.793 11.207a.5.5 0 0 1 0-.708L14.6 9H10.5a.5.5 0 0 1 0-1h4.102l-1.808-1.499a.5.5 0 0 1 .374-.827 4.5 4.5 0 0 0-4.502-3.878 4.673 4.673 0 0 0-3.321 1.34A6 6 0 0 0 1.556 7.202l-1.4.7A7 7 0 0 1 8 0a7 7 0 0 1 6.841 5.485l1.096-.949A.5.5 0 0 1 16 5.5v5a.5.5 0 0 1-.5.5h-5a.5.5 0 0 1-.5-.5zM4.35 6.467a4.5 4.5 0 0 0 4.291 3.284 4.673 4.673 0 0 0 3.321-1.341A6 6 0 0 0 1.556 7.202l-1.4.7A7 7 0 0 1 8 16a7 7 0 0 1-6.841-5.485l-1.096.949A.5.5 0 0 1 0 10.5v-5A.5.5 0 0 1 .5 5.5h5a.5.5 0 0 1 0 1H1.359l1.808 1.499a.5.5 0 0 1-.374.827 4.5 4.5 0 0 0 4.502 3.878 4.673 4.673 0 0 0 3.321-1.34A6 6 0 0 0 1.556 7.202z"/></svg>
            </button>
            <button id="play" class="bigbtn" title="Play/Pause">
              <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" viewBox="0 0 16 16"><path d="M11.596 8.697l-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/></svg>
            </button>
            <button id="ffw" class="smbtn" title="Fast Forward 10s">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16"><path d="M3.207 4.793a.5.5 0 0 1 0 .708L1.4 7H5.5a.5.5 0 0 1 0 1H1.398l1.808 1.499a.5.5 0 0 1-.374.827 4.5 4.5 0 0 0 4.502 3.878 4.673 4.673 0 0 0 3.321-1.34A6 6 0 0 0 14.444 8.798l1.4-.7A7 7 0 0 1 8 16a7 7 0 0 1-6.841-5.485l-1.096.949A.5.5 0 0 1 0 10.5v-5A.5.5 0 0 1 .5 5.5h5a.5.5 0 0 1 0 1H4.641l-1.808-1.499a.5.5 0 0 1-.374-.827 4.5 4.5 0 0 0-4.502-3.878 4.673 4.673 0 0 0-3.321 1.34A6 6 0 0 0 14.444 8.798zM11.65 9.533a4.5 4.5 0 0 0-4.291-3.284 4.673 4.673 0 0 0-3.321 1.341A6 6 0 0 0 1.583 8.798l-1.4.7A7 7 0 0 1 8 0a7 7 0 0 1 6.841 5.485l1.096-.949A.5.5 0 0 1 16 5.5v5a.5.5 0 0 1-.5.5h-5a.5.5 0 0 1 0-1H14.641l-1.808-1.499a.5.5 0 0 1-.374-.827z"/></svg>
            </button>
            <button id="next" class="smbtn" title="Next">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16"><path d="M15.5 3.5a.5.5 0 0 1 0 1v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5zM11 4.5v7l-6.363 3.692c-.54.313-1.233-.066-1.233-.697V2.846c0-.63.692-1.01 1.233-.696L11 4.5z"/></svg>
            </button>
          </div>
          <button id="loop" class="smbtn" title="Toggle loop">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16"><path d="M0 8a2 2 0 0 1 2-2h10.93l-3.65-3.65a.5.5 0 0 1 .707-.707l5.44 5.44a.5.5 0 0 1 0 .707l-5.44 5.44a.5.5 0 0 1-.707-.707l3.65-3.65H2a2 2 0 0 1-2-2z"/></svg>
          </button>
        </div>
        
        <div class="track-info">
          <div class="title" id="nowTitle">01 Dai 1 Ka - Kaiwa</div>
          <div class="audio-visualizer" id="audioVisualizer">
              <div class="bar-item" style="height: 6px;"></div>
              <div class="bar-item" style="height: 10px;"></div>
              <div class="bar-item" style="height: 8px;"></div>
              <div class="bar-item" style="height: 12px;"></div>
              <div class="bar-item" style="height: 7px;"></div>
              <div class="bar-item" style="height: 9px;"></div>
              <div class="bar-item" style="height: 11px;"></div>
          </div>
        </div>

        <div class="progress" id="progress">
          <div class="bar" id="bar"></div>
        </div>
        <div class="time"><span id="current">0:00</span><span id="duration">0:00</span></div>

        <div class="controlsBottom">
          <div class="speed-control">
            <label class="tiny">Speed</label>
            <select id="speed">
              <option value="0.25">0.25×</option>
              <option value="0.5">0.5×</option>
              <option value="0.75">0.75×</option>
              <option value="1.0" selected>1×</option>
              <option value="1.25">1.25×</option>
              <option value="1.5">1.5×</option>
              <option value="1.75">1.75×</option>
              <option value="2.0">2×</option>
              <option value="2.5">2.5×</option>
              <option value="3.0">3×</option>
            </select>
          </div>

          <div class="volume-control">
            <label class="tiny">Volume</label>
            <input id="vol" type="range" min="0" max="1" step="0.01" value="1">
          </div>
        </div>

      </div> 
      <div class="copyright">
        &copy; 2025 Yudha. All rights reserved.
        <div class="instagram-link">
            <a href="https://www.instagram.com/isal_yud" target="_blank">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917 0 0 0-1.417.923A3.927 3.927 0 0 0 .42 2.76C.222 3.269.087 3.85.048 4.703.01 5.555 0 5.827 0 8s.01 2.444.048 3.297c.04.852.174 1.433.372 1.942.205.526.478.96.923 1.417.444.445.877.718 1.417.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.297-.048c.852-.04 1.433-.174 1.942-.372a3.927 3.927 0 0 0 1.417-.923c.445-.444.718-.877.923-1.417.198-.51.333-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.444-.048-3.297c-.04-.852-.174-1.433-.372-1.942a3.917 3.917 0 0 0-.923-1.417A3.927 3.927 0 0 0 13.24 0.42c-.51-.198-1.09-.333-1.942-.372C10.445.01 10.173 0 8 0zm0 2.16c2.115 0 2.385.008 3.232.046.78.035 1.204.166 1.486.275.373.145.64.318.92.599.28.28.453.546.598.92.11.281.24.705.275 1.485.038.843.046 1.113.046 3.233 0 2.115-.008 2.385-.046 3.232-.035.78-.166 1.204-.275 1.486a2.59 2.59 0 0 1-.599.92c-.28.28-.546.453-.92.598-.281.11-.705.24-1.485.275-.843.038-1.113.046-3.233.046-2.115 0-2.385-.008-3.232-.046-.78-.035-1.204-.166-1.486-.275a2.59 2.59 0 0 1-.92-.599c-.28-.28-.453-.546-.598-.92-.11-.281-.24-.705-.275-1.485C2.16 10.445 2.152 10.173 2.152 8s.008-2.444.046-3.297c.035-.78.166-1.204.275-1.486.145-.373.318-.64.599-.92.28-.28.546-.453.92-.598.281-.11.705-.24 1.485-.275C5.555 2.16 5.827 2.152 8 2.152zm0 3.654a4.111 4.111 0 1 0 0 8.222 4.111 4.111 0 0 0 0-8.222zM8 12a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm5.725-4.522a1.2 1.2 0 1 0 0 2.4 1.2 1.2 0 0 0 0-2.4z"/>
                </svg>
                isal_yud
            </a>
        </div>
      </div>
    </section>

    <aside class="playlist-card">
      <div class="playlist-header">
        <strong>Playlist (87)</strong>
        <div style="font-size:13px;color:var(--muted)"><button id="playAll" class="smbtn" title="Play All">▶ All</button></div>
      </div>
      <div class="playlist" id="playlist"></div>
    </aside>
  </div>

  <audio id="audio" preload="metadata"></audio>

  <script>
    const files = [
      // ... (file list yang panjang)
      "01 Dai 1 Ka - Kaiwa.mp3","02 Dai 1 Ka - Mondai 1.mp3","03 Dai 1 Ka - Mondai 2.mp3","04 Dai 1 Ka - Mondai 3.mp3",
      "05 Dai 2 Ka - Kaiwa.mp3","06 Dai 2 Ka - Mondai 1.mp3","07 Dai 2 Ka - Mondai 2.mp3","08 Dai 2 Ka - Mondai 3.mp3",
      "09 Dai 3 Ka - Kaiwa.mp3","10 Dai 3 Ka - Mondai 1.mp3","11 Dai 3 Ka - Mondai 2.mp3","12 Dai 4 Ka - Kaiwa.mp3",
      "13 Dai 4 Ka - Mondai 1.mp3","14 Dai 4 Ka - Mondai 2.mp3","15 Dai 4 Ka - Mondai 3.mp3","16 Dai 4 Ka - Mondai 4.mp3",
      "17 Dai 5 Ka - Kaiwa.mp3","18 Dai 5 Ka - Mondai 1.mp3","19 Dai 5 Ka - Mondai 2.mp3","20 Dai 5 Ka - Mondai 3.mp3",
      "21 Dai 6 Ka - Kaiwa.mp3","22 Dai 6 Ka - Mondai 1.mp3","23 Dai 6 Ka - Mondai 2.mp3","24 Dai 7 Ka - Kaiwa.mp3",
      "25 Dai 7 Ka - Mondai 1.mp3","26 Dai 7 Ka - Mondai 2.mp3","27 Dai 7 Ka - Mondai 3.mp3","28 Dai 8 Ka - Kaiwa.mp3",
      "29 Dai 8 Ka - Mondai 1.mp3","30 Dai 8 Ka - Mondai 2.mp3","31 Dai 8 Ka - Mondai 3.mp3","32 Dai 9 Ka - Kaiwa.mp3",
      "33 Dai 9 Ka - Mondai 1.mp3","34 Dai 9 Ka - Mondai 2.mp3","35 Dai 10 Ka - Kaiwa.mp3","36 Dai 10 Ka - Mondai 1.mp3",
      "37 Dai 10 Ka - Mondai 2.mp3","38 Dai 10 Ka - Mondai 3.mp3","39 Dai 11 Ka - Kaiwa.mp3","40 Dai 11 Ka - Mondai 1.mp3",
      "41 Dai 11 Ka - Mondai 2.mp3","42 Dai 11 Ka - Mondai 3.mp3","43 Dai 12 Ka - Kaiwa.mp3","44 Dai 12 Ka - Mondai 1.mp3",
      "45 Dai 12 Ka - Mondai 2.mp3","46 Dai 13 Ka - Kaiwa.mp3","47 Dai 13 Ka - Mondai 1.mp3","48 Dai 13 Ka - Mondai 2.mp3",
      "49 Dai 14 Ka - Kaiwa.mp3","50 Dai 14 Ka - Mondai 1.mp3","51 Dai 14 Ka - Mondai 2.mp3","52 Dai 14 Ka - Mondai 3.mp3",
      "53 Dai 15 Ka - Kaiwa.mp3","54 Dai 15 Ka - Mondai 1.mp3","55 Dai 15 Ka - Mondai 2.mp3","56 Dai 16 Ka - Kaiwa.mp3",
      "57 Dai 16 Ka - Mondai 1.mp3","58 Dai 16 Ka - Mondai 2.mp3","59 Dai 16 Ka - Mondai 3.mp3","60 Dai 17 Ka - Kaiwa.mp3",
      "61 Dai 17 Ka - Mondai 1.mp3","62 Dai 17 Ka - Mondai 2.mp3","63 Dai 18 Ka - Kaiwa.mp3","64 Dai 18 Ka - Mondai 1.mp3",
      "65 Dai 18 Ka - Mondai 2.mp3","66 Dai 19 Ka - Kaiwa.mp3","67 Dai 19 Ka - Mondai 1.mp3","68 Dai 19 Ka - Mondai 2.mp3",
      "69 Dai 20 Ka - Kaiwa.mp3","70 Dai 20 Ka - Mondai 1.mp3","71 Dai 20 Ka - Mondai 2.mp3","72 Dai 21 Ka - Kaiwa.mp3",
      "73 Dai 21 Ka - Mondai 1.mp3","74 Dai 21 Ka - Mondai 2.mp3","75 Dai 22 Ka - Kaiwa.mp3","76 Dai 22 Ka - Mondai 1.mp3",
      "77 Dai 22 Ka - Mondai 2.mp3","78 Dai 23 Ka - Kaiwa.mp3","79 Dai 23 Ka - Mondai 1.mp3","80 Dai 23 Ka - Mondai 2.mp3",
      "81 Dai 23 Ka - Mondai 3.mp3","82 Dai 24 Ka - Kaiwa.mp3","83 Dai 24 Ka - Mondai 1.mp3","84 Dai 24 Ka - Mondai 2.mp3",
      "85 Dai 25 Ka - Kaiwa.mp3","86 Dai 25 Ka - Mondai 1.mp3","87 Dai 25 Ka - Mondai 2.mp3"
    ];

    // Ikon SVG untuk tombol Play/Pause
    const playIcon = '<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" viewBox="0 0 16 16"><path d="M11.596 8.697l-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/></svg>';
    const pauseIcon = '<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" viewBox="0 0 16 16"><path d="M5.5 3.5A.5.5 0 0 1 6 4v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5zm4-1a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5z"/></svg>';
    
    // Elements
    const audio = document.getElementById('audio');
    const playBtn = document.getElementById('play');
    const nowTitle = document.getElementById('nowTitle');
    const bar = document.getElementById('bar');
    const progress = document.getElementById('progress');
    const cur = document.getElementById('current');
    const dur = document.getElementById('duration');
    const speed = document.getElementById('speed');
    const vol = document.getElementById('vol');
    const loopBtn = document.getElementById('loop');
    const shuffleBtn = document.getElementById('shuffle');
    const playlistEl = document.getElementById('playlist');
    const audioVisualizer = document.getElementById('audioVisualizer');
    
    // state
    let current = 0;
    let isPlaying = false;
    let isLoop = false;
    let isShuffle = false;
    let order = files.map((_,i)=>i);

    // build playlist UI
    function buildList(){
      playlistEl.innerHTML = '';
      files.forEach((f,i)=>{
        const tr = document.createElement('div');
        tr.className = 'track';
        tr.dataset.index = i;
        const trackNumber = String(i+1).padStart(2,'0'); 
        const fileNameWithoutExtension = f.replace(/\.mp3$/, '');
        tr.innerHTML = `<div class="num">${trackNumber}</div><div class="name">${fileNameWithoutExtension}</div><div class="equalizer-icon"><div class="eq-bar"></div><div class="eq-bar"></div><div class="eq-bar"></div></div>`;
        tr.onclick = ()=>{ playIndex(i); };
        playlistEl.appendChild(tr);
      });
      highlight();
    }

    function highlight(){
      [...document.querySelectorAll('.track')].forEach(n=>n.classList.remove('active'));
      const el = document.querySelector('.track[data-index="'+current+'"]');
      if(el) el.classList.add('active');
      if (el) {
        el.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }
    }

    function setSource(i){
      current = i; 
      const path = encodeURI(files[i]);
      audio.src = path;
      const fileNameWithoutExtension = files[i].replace(/\.mp3$/, '');
      nowTitle.textContent = fileNameWithoutExtension;
      highlight();
    }

    function playIndex(i){
      current = i;
      setSource(current);
      audio.play().catch(()=>{});
      isPlaying = true;
      playBtn.innerHTML = pauseIcon;
    }

    // Toggling Visualizer Class
    function updateVisualizer(playing) {
        [...audioVisualizer.querySelectorAll('.bar-item')].forEach(bar => {
            bar.classList.toggle('active', playing);
            // Atur ketinggian acak saat mulai agar terlihat organik
            if (playing) {
                bar.style.height = (Math.random() * 8 + 4) + 'px'; // 4px to 12px
            } else {
                 bar.style.height = '6px'; // Ketinggian diam saat pause
            }
        });
    }

    // controls
    playBtn.onclick = ()=>{
      if(!audio.src){ setSource(current); }
      if(audio.paused){ 
        audio.play(); 
        playBtn.innerHTML = pauseIcon; 
        isPlaying=true; 
      }
      else { 
        audio.pause(); 
        playBtn.innerHTML = playIcon; 
        isPlaying=false; 
      }
      updateVisualizer(isPlaying);
    };

    document.getElementById('prev').onclick = ()=>{ current = (current - 1 + files.length) % files.length; setSource(current); audio.play(); };
    document.getElementById('next').onclick = ()=>{ current = (current + 1) % files.length; setSource(current); audio.play(); };
    document.getElementById('rwd').onclick = ()=>{ if (!isNaN(audio.duration)) { audio.currentTime = Math.max(audio.currentTime - 10, 0); } };
    document.getElementById('ffw').onclick = ()=>{ if (!isNaN(audio.duration)) { audio.currentTime = Math.min(audio.currentTime + 10, audio.duration); } };
    document.getElementById('playAll').onclick = ()=>{ setSource(isShuffle ? order[0] : 0); audio.play(); playBtn.innerHTML = pauseIcon; updateVisualizer(true);};

    audio.addEventListener('timeupdate', ()=>{
      if (!isNaN(audio.duration)){
        const pct = (audio.currentTime / audio.duration) * 100;
        bar.style.width = pct + '%';
        cur.textContent = formatTime(audio.currentTime);
        dur.textContent = formatTime(audio.duration);
      }
      const volPct = audio.volume * 100;
      vol.style.background = `linear-gradient(to right, var(--accent) ${volPct}%, rgba(255,255,255,0.08) ${volPct}%)`;
    });
    
    // (Logic for progress bar click, audio ended, shuffle/loop, speed/volume controls remains the same)
    
    // Re-bind shuffle/loop clicks to include visualizer update
    loopBtn.onclick = ()=>{ isLoop = !isLoop; loopBtn.classList.toggle('active-control', isLoop); };
    shuffleBtn.onclick = ()=>{ 
        isShuffle = !isShuffle; 
        shuffleBtn.classList.toggle('active-control', isShuffle); 
        // ... (logic shuffle/order remains same)
    };

    audio.addEventListener('ended', ()=>{
        // ... (logic for next track remains same)
        // Pastikan visualizer berhenti jika tidak ada track selanjutnya yang otomatis diputar
        if (!isLoop && ((!isShuffle && current === files.length - 1) || (isShuffle && shuffledHistory.length === files.length))) {
             isPlaying = false;
             playBtn.innerHTML = playIcon; 
             updateVisualizer(false);
        }
    });


    function formatTime(sec){
      if(!sec || isNaN(sec)) return '0:00';
      const s = Math.floor(sec%60).toString().padStart(2,'0');
      const m = Math.floor(sec/60);
      return `${m}:${s}`;
    }

    // init
    buildList();
    setSource(0);
    audio.load();
    playBtn.innerHTML = playIcon; 
    loopBtn.classList.toggle('active-control', isLoop); 
    shuffleBtn.classList.toggle('active-control', isShuffle);
    vol.dispatchEvent(new Event('input')); 
    updateVisualizer(false); // Sembunyikan visualizer saat init
  </script>
</body>
</html>
